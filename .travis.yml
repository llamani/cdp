language: php

sudo: false

services:
  - docker

cache:
  directories:
    - $HOME/.composer/cache/files

php :
  - '7.3'

env:
  - SYMFONY_VERSION="4.3.*" DB=mysql

matrix:
  fast_finish: true
  include:
    - php: 7.3
    - php: hhvm
  allow_failures:
    - php: hhvm


install:
  - cp ./.env api/
  - docker-compose up -d --build
  - docker-compose exec api composer install
  - cp ./.env api/ #composer install réécrit le fichier .env
  - docker-compose exec api php bin/console doctrine:migrations:migrate -n
  - docker-compose exec api php bin/console doctrine:fixtures:load -n

script:
  - docker-compose exec api php bin/phpunit